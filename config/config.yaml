# =========================
# üîß PORTS & CORE SETTINGS
# =========================
port: 7891 # HTTP proxy port (changed to avoid conflict)
socks-port: 7892 # SOCKS5 proxy port
mixed-port: 7893 # Mixed port (HTTP + SOCKS5) - avoid port conflict
redir-port: 9797
tproxy-port: 9898
mode: rule
allow-lan: true
bind-address: "*"
log-level: warning
unified-delay: true
ipv6: false
external-controller: 0.0.0.0:9090
tcp-concurrent: true
secret: "mihomo-gateway-2024"

# =========================
# üîñ PROFILE
# =========================
profile:
  store-selected: true
  store-fake-ip: true

# =========================
# üß© TUN MODE
# =========================
tun:
  enable: true
  device: mihomo-tun
  mtu: 9000
  stack: mixed
  strict-route: true
  dns-hijack:
    - any:53
    - tcp://any:53
  auto-route: true
  auto-detect-interface: true
  inet4-address:
    - 172.19.0.1/30
  endpoint-independent-nat: true

# =========================
# üåê DNS SETTINGS
# =========================
dns:
  enable: true
  prefer-h3: false
  listen: 0.0.0.0:1053
  ipv6: false
  use-hosts: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16

  default-nameserver:
    - 223.5.5.5
    - 1.1.1.1
    - 8.8.8.8

  nameserver:
    - 223.5.5.5
    - 1.1.1.1
    - 8.8.8.8

  fallback:
    - 9.9.9.9
    - 1.0.0.1
    - 8.8.4.4

  fake-ip-filter:
    # Sistem lokal (WAJIB)
    - "+.lan"
    - "+.local"
    - "+.localhost"
    - "+.localdomain"

    # NTP / sinkronisasi waktu (WAJIB)
    - "+.ntp.org"
    - "+.pool.ntp.org"
    - "+.time.windows.com"
    - "+.time.apple.com"
    - "+.time.google.com"

    # Google push notif (WAJIB)
    - "mtalk.google.com"
    - "mtalk4.google.com"

    # STUN untuk VoIP/game (WAJIB)
    - "+.stun.*"

    # GitHub (WAJIB)
    - "+.github.com"
    - "+.githubusercontent.com"
    - "+.ghcr.io"

    # GitLab (WAJIB)
    - "+.gitlab.com"

    # Docker registry (WAJIB)
    - "+.docker.com"
    - "+.docker.io"
    - "+.registry-1.docker.io"

    # CDN provider penting (WAJIB real DNS)
    - "+.cloudflare.com"
    - "+.cloudflare-dns.com"
    - "+.akamaihd.net"
    - "+.cloudfront.net"
    - "+.fastly.net"

    # Google streaming (WAJIB)
    - "+.googlevideo.com"

    # Netflix streaming (WAJIB)
    - "+.nflxvideo.net"
    - "+.netflix.com"

    # Fix bug Google Lens
    - "lens.l.google.com"

  fallback-filter:
    geoip: true
    geoip-code: ID
    ipcidr:
      - 0.0.0.0/8
      - 10.0.0.0/8
      - 127.0.0.0/8
      - 169.254.0.0/16
      - 172.16.0.0/12
      - 192.168.0.0/16
      - 224.0.0.0/4
      - 240.0.0.0/4
      - 255.255.255.255/32
    domain:
      - "+.google.com"
      - "+.facebook.com"
      - "+.youtube.com"
      - "+.githubusercontent.com"
      - "+.googlevideo.com"
      - "+.*"

# =========================
# üöÄ PROXY PROVIDERS
# =========================
proxy-providers:
  VPN-1:
    type: file
    path: "/opt/mihomo-gateway/config/proxy_providers/vpn1.yaml"
    health-check:
      enable: true
      url: http://www.gstatic.com/generate_204
      interval: 30

  VPN-2:
    type: file
    path: "/opt/mihomo-gateway/config/proxy_providers/vpn2.yaml"
    health-check:
      enable: true
      url: http://www.gstatic.com/generate_204
      interval: 30

# =========================
# üìã RULE PROVIDERS (Simple)
# =========================
rule-providers:
  # Streaming services (Netflix, YouTube, etc.)
  streaming_provider:
    type: file
    behavior: domain
    path: /opt/mihomo-gateway/config/rule_providers/streaming.yaml

  # Gaming services
  gaming_provider:
    type: file
    behavior: domain
    path: /opt/mihomo-gateway/config/rule_providers/gaming.yaml

  # Social media
  social_provider:
    type: file
    behavior: domain
    path: /opt/mihomo-gateway/config/rule_providers/social.yaml

  # Custom rules
  custom_provider:
    type: file
    behavior: domain
    path: /opt/mihomo-gateway/config/rule_providers/custom.yaml

# =========================
# üéØ PROXY GROUPS
# =========================
proxy-groups:
  - name: INTERNET-UMUM
    type: fallback
    disable-udp: false
    use:
      - VPN-1
      - VPN-2
    url: http://www.gstatic.com/generate_204
    interval: 60

  - name: STREAMING√óSOSMED
    type: select
    disable-udp: false
    use:
      - VPN-2
      - VPN-1

  - name: Situs X
    type: select
    disable-udp: false
    use:
      - VPN-2

  - name: GAME
    type: url-test
    disable-udp: false
    use:
      - VPN-1
    url: http://www.gstatic.com/generate_204
    interval: 30

# =========================
# ‚öôÔ∏è RULES
# =========================
rules:
  # Proteksi fake-ip
  - IP-CIDR,198.18.0.1/16,REJECT,no-resolve

  # Blokir DoH bypass
  - DOMAIN-SUFFIX,dns.google,REJECT
  - DOMAIN-SUFFIX,cloudflare-dns.com,REJECT

  # Bypass push notif Google (biar gak ganggu ping)
  - DOMAIN-SUFFIX,mtalk.google.com,DIRECT
  - DOMAIN-SUFFIX,mtalk4.google.com,DIRECT
  - DST-PORT,5228,DIRECT

  # üéÆ Game Ports (MLBB / Magic Chess / FF / Funny Fighter)
  - DST-PORT,5000-5221,GAME,udp,no-resolve
  - DST-PORT,5224-5287,GAME,udp,no-resolve
  - DST-PORT,5289-5700,GAME,udp,no-resolve
  - DST-PORT,8443,GAME,udp,no-resolve
  - DST-PORT,9000-9010,GAME,udp,no-resolve
  - DST-PORT,10000-10100,GAME,udp,no-resolve
  - DST-PORT,5055-5058,GAME,udp,no-resolve
  - DST-PORT,6006-6012,GAME,udp,no-resolve

  # IP server MLBB / FF / Funny Fighter
  - IP-CIDR,103.10.124.0/23,GAME,no-resolve
  - IP-CIDR,103.10.125.0/24,GAME,no-resolve
  - IP-CIDR,13.213.0.0/16,GAME,no-resolve
  - IP-CIDR,45.64.0.0/16,GAME,no-resolve
  - IP-CIDR,52.74.0.0/16,GAME,no-resolve
  - IP-CIDR,119.81.0.0/16,GAME,no-resolve
  - IP-CIDR,161.117.0.0/16,GAME,no-resolve
  - IP-CIDR,43.249.0.0/16,GAME,no-resolve
  - IP-CIDR,103.11.128.0/22,GAME,no-resolve
  - IP-CIDR,203.205.0.0/16,GAME,no-resolve
  - IP-CIDR,182.254.0.0/16,GAME,no-resolve

  # üåê Streaming & Sosmed
  - DOMAIN-SUFFIX,youtube.com,STREAMING√óSOSMED
  - DOMAIN-SUFFIX,googlevideo.com,STREAMING√óSOSMED
  - DOMAIN-SUFFIX,ytimg.com,STREAMING√óSOSMED
  - DOMAIN-SUFFIX,instagram.com,STREAMING√óSOSMED
  - DOMAIN-SUFFIX,cdninstagram.com,STREAMING√óSOSMED
  - DOMAIN-SUFFIX,tiktok.com,STREAMING√óSOSMED
  - DOMAIN-SUFFIX,tiktokcdn.com,STREAMING√óSOSMED
  - DOMAIN-SUFFIX,tiktokv.com,STREAMING√óSOSMED
  - DOMAIN-SUFFIX,telegram.org,STREAMING√óSOSMED
  - DOMAIN-SUFFIX,telegra.ph,STREAMING√óSOSMED
  - DOMAIN-SUFFIX,facebook.com,STREAMING√óSOSMED
  - DOMAIN-SUFFIX,fbcdn.net,STREAMING√óSOSMED
  - DOMAIN-SUFFIX,spotify.com,STREAMING√óSOSMED
  - DOMAIN-SUFFIX,netflix.com,STREAMING√óSOSMED
  - DOMAIN-SUFFIX,nflxvideo.net,STREAMING√óSOSMED

  # üîû Situs X
  - DOMAIN-SUFFIX,pornhub.com,Situs X
  - DOMAIN-SUFFIX,phncdn.com,Situs X
  - DOMAIN-SUFFIX,phprcdn.com,Situs X

  # üìã Rule Providers (Custom rules dari file)
  - RULE-SET,custom_provider,INTERNET-UMUM
  - RULE-SET,streaming_provider,STREAMING√óSOSMED
  - RULE-SET,gaming_provider,GAME
  - RULE-SET,social_provider,STREAMING√óSOSMED

  # Default
  - MATCH,INTERNET-UMUM
